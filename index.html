<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Stella Maris · Recetas</title>

<style>
:root{
  --bg:#0f1115;
  --stroke:rgba(255,255,255,.10);
  --text:#e8ecf6;
  --muted:rgba(232,236,246,.62);
  --brand:#7aa2ff;
  --bad:#ff5b6b;
  --r:18px;
  --press: translateY(1px) scale(.99);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
  background:var(--bg);
  color:var(--text);
}
.wrap{max-width:1000px;margin:0 auto;padding:12px 12px 60px}
.top{
  display:flex;justify-content:space-between;align-items:center;
  border:1px solid var(--stroke);
  padding:10px 12px;border-radius:var(--r);
  background:rgba(255,255,255,.03);
}
.btn{
  border:1px solid rgba(122,162,255,.45);
  background:linear-gradient(180deg, rgba(122,162,255,.18), rgba(122,162,255,.10));
  color:var(--text);
  padding:9px 12px;border-radius:14px;
  font-weight:800;font-size:13px;
  cursor:pointer;
  transition:.08s;
}
.btn:active{transform:var(--press)}
.btn.ghost{border-color:var(--stroke);background:rgba(255,255,255,.03)}
.btn.bad{border-color:rgba(255,91,107,.45);background:rgba(255,91,107,.15)}
.btn.icon{
  padding:6px 10px;
  font-size:15px;
  border-radius:12px;
}
.tabs{display:flex;gap:8px;margin-top:12px}
.tab{
  border:1px solid var(--stroke);
  background:rgba(255,255,255,.03);
  padding:9px 14px;border-radius:999px;
  font-size:13px;font-weight:800;
  cursor:pointer;
}
.tab.active{
  border-color:rgba(122,162,255,.45);
  background:rgba(122,162,255,.14);
}
.card{
  border:1px solid var(--stroke);
  border-radius:var(--r);
  padding:12px;
  background:rgba(255,255,255,.03);
  margin-top:12px;
}
label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
input,select{
  width:100%;
  padding:11px 12px;
  border-radius:14px;
  border:1px solid var(--stroke);
  background:rgba(0,0,0,.25);
  color:var(--text);
  font-size:16px;
  outline:none;
}
input:focus,select:focus{
  border-color:rgba(122,162,255,.6);
  box-shadow:0 0 0 3px rgba(122,162,255,.1);
}
.moneyField{position:relative}
.moneyField:before{
  content:"$";
  position:absolute;
  left:12px;
  top:50%;
  transform:translateY(-50%);
  color:rgba(232,236,246,.7);
  font-weight:900;
  pointer-events:none;
}
.moneyField input{
  padding-left:34px;
  padding-right:12px;
  text-align:left;
}
table{
  width:100%;
  border-collapse:separate;
  border-spacing:0 6px;
}
td,th{
  padding:8px;
  font-size:14px;
}
td{
  border:1px solid var(--stroke);
  background:rgba(255,255,255,.02);
}
td:first-child{border-radius:14px 0 0 14px}
td:last-child{border-radius:0 14px 14px 0}
.cell{
  width:100%;
  border:1px solid rgba(255,255,255,.15);
  background:rgba(255,255,255,.08);
  border-radius:12px;
  padding:9px 12px;
  font-size:16px;
  color:#fff;
}
.kpis{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
.kpi{
  border:1px solid var(--stroke);
  border-radius:14px;
  padding:10px;
  background:rgba(255,255,255,.02);
}
.kpi span{font-size:12px;color:var(--muted)}
.kpi b{display:block;margin-top:4px;font-size:16px}
</style>
</head>

<body>
<div class="wrap">

<div class="top">
  <b>Recetas</b>
  <div>
    <button class="btn ghost" id="btnBackup">Exportar</button>
    <button class="btn ghost" id="btnRestore">Importar</button>
  </div>
</div>

<div class="tabs">
  <button class="tab active" id="tabInsumos">Insumos</button>
  <button class="tab" id="tabArmar">Armar receta</button>
</div>

<!-- INSUMOS -->
<div id="viewInsumos">

<div class="card">
  <label>Nombre</label>
  <input id="ingName">

  <label style="margin-top:10px">Unidad</label>
  <select id="ingUnit">
    <option value="kg">kg</option>
    <option value="u">unidad</option>
  </select>

  <label style="margin-top:10px">Costo</label>
  <div class="moneyField">
    <input id="ingCost" type="text" inputmode="numeric">
  </div>

  <div style="margin-top:10px">
    <button class="btn" id="addIng">Agregar</button>
  </div>
</div>

<div class="card">
  <table>
    <thead>
      <tr>
        <th>Nombre</th>
        <th>Costo</th>
        <th></th>
      </tr>
    </thead>
    <tbody id="ingTable"></tbody>
  </table>
</div>

</div>

<!-- ARMAR -->
<div id="viewArmar" style="display:none">

<div class="card">
  <label>Nombre receta</label>
  <input id="recName">

  <label style="margin-top:10px">Precio venta</label>
  <div class="moneyField">
    <input id="sellPrice" type="text" inputmode="numeric">
  </div>

  <div style="margin-top:10px">
    <button class="btn" id="saveRec">Confirmar receta</button>
  </div>
</div>

<div class="card">
  <div class="kpis">
    <div class="kpi">
      <span>Precio</span>
      <b id="kPrice">$0</b>
    </div>
  </div>
</div>

</div>

</div>

<script>
const LS="sm_data_v6";
let data=JSON.parse(localStorage.getItem(LS)||'{"ingredients":[],"recipes":[]}');

function save(){localStorage.setItem(LS,JSON.stringify(data));render();}

function formatMoneyInput(el){
  el.addEventListener("input",()=>{
    let digits=el.value.replace(/\D/g,"");
    digits=digits.replace(/^0+(?=\d)/,"");
    el.value=digits.replace(/\B(?=(\d{3})+(?!\d))/g,".");
  });
}

formatMoneyInput(ingCost);
formatMoneyInput(sellPrice);

addIng.onclick=()=>{
  if(!ingName.value.trim()) return;
  data.ingredients.push({
    id:Date.now(),
    name:ingName.value.trim(),
    unit:ingUnit.value,
    cost:parseInt(ingCost.value.replace(/\D/g,"")||0)
  });
  ingName.value="";
  ingCost.value="";
  save();
};

function render(){
  ingTable.innerHTML="";
  data.ingredients.forEach(ing=>{
    let tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${ing.name}</td>
      <td>
        <div class="moneyField">
          <input class="cell costEdit" data-id="${ing.id}" value="${ing.cost.toLocaleString("es-AR")}">
        </div>
      </td>
      <td>
        <button class="btn bad icon" data-del="${ing.id}">➖</button>
      </td>
    `;
    ingTable.appendChild(tr);
  });

  document.querySelectorAll(".costEdit").forEach(el=>{
    formatMoneyInput(el);
    el.addEventListener("blur",()=>{
      let id=parseInt(el.dataset.id);
      let ing=data.ingredients.find(x=>x.id===id);
      ing.cost=parseInt(el.value.replace(/\D/g,"")||0);
      save();
    });
  });

  document.querySelectorAll("[data-del]").forEach(btn=>{
    btn.onclick=()=>{
      let id=parseInt(btn.dataset.del);
      data.ingredients=data.ingredients.filter(x=>x.id!==id);
      save();
    };
  });

  kPrice.textContent=sellPrice.value?("$ "+sellPrice.value):"$0";
}

tabInsumos.onclick=()=>{
  tabInsumos.classList.add("active");
  tabArmar.classList.remove("active");
  viewInsumos.style.display="";
  viewArmar.style.display="none";
};

tabArmar.onclick=()=>{
  tabArmar.classList.add("active");
  tabInsumos.classList.remove("active");
  viewInsumos.style.display="none";
  viewArmar.style.display="";
};

sellPrice.addEventListener("input",render);

render();
</script>

</body>
</html>